<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>BI Notes</title>
  <meta name="description" content="Study notes taken from BI courses and self learning.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="BI Notes" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://github.com/James-SR/BI-Notes" />
  
  <meta property="og:description" content="Study notes taken from BI courses and self learning." />
  <meta name="github-repo" content="James-SR/BI-Notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="BI Notes" />
  
  <meta name="twitter:description" content="Study notes taken from BI courses and self learning." />
  

<meta name="author" content="James Solomon-Rounce">


<meta name="date" content="2018-02-24">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Business Intelligence Notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="querying-data-with-transact-sql.html"><a href="querying-data-with-transact-sql.html"><i class="fa fa-check"></i><b>1</b> Querying Data with Transact-SQL</a><ul>
<li class="chapter" data-level="1.1" data-path="querying-data-with-transact-sql.html"><a href="querying-data-with-transact-sql.html#introduction-to-transact-sql"><i class="fa fa-check"></i><b>1.1</b> Introduction to Transact-SQL</a><ul>
<li class="chapter" data-level="1.1.1" data-path="querying-data-with-transact-sql.html"><a href="querying-data-with-transact-sql.html#data-types"><i class="fa fa-check"></i><b>1.1.1</b> Data Types</a></li>
<li class="chapter" data-level="1.1.2" data-path="querying-data-with-transact-sql.html"><a href="querying-data-with-transact-sql.html#working-with-nulls"><i class="fa fa-check"></i><b>1.1.2</b> Working with NULLs</a></li>
<li class="chapter" data-level="1.1.3" data-path="querying-data-with-transact-sql.html"><a href="querying-data-with-transact-sql.html#lab-exercises"><i class="fa fa-check"></i><b>1.1.3</b> Lab Exercises</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BI Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="querying-data-with-transact-sql" class="section level1">
<h1><span class="header-section-number">1</span> Querying Data with Transact-SQL</h1>
<hr />
<p>Notes taken during/inspired by the edX course ‘Querying Data with Transact-SQL - Microsoft: DAT201x’ by Graeme Malcolm and Geoff Allix.</p>
<p><strong><em>Course Handouts</em></strong></p>
<ul>
<li><a href="../files/TSQL/Syllabus.PDF">Course Syllabus</a></li>
<li><a href="../files/TSQL/DAT201x.PDF">Getting Started Guide Including Install</a></li>
<li><a href="../files/TSQL/AW_ER.pdf">Adventure Works Entity Relationship Diagram</a></li>
<li><a href="../files/TSQL/AW-oltp-install-script">Adeventure Works db install script</a><br />
NOTE: Remember to ensure read only access for everyone to the folder containing the .SQL and other files</li>
<li><a href="https://microsoftlearning.github.io/QueryingT-SQL/">GitHib Repo for course including course materials, slids, labs etc</a></li>
<li><a href="../files/TSQL/TSQLCourseFiles.zip">A copy of the above materials should they be changed or removed</a></li>
</ul>
<p><strong><em>Other useful links</em></strong> * <a href="https://docs.microsoft.com/en-gb/sql/t-sql/language-reference">Transact-SQL Refrence</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(DBI)</code></pre></div>
<pre><code>## Loading required package: methods</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># creates a connection to the SQL database</span>
<span class="co"># note that &quot;con&quot; will be used later in each connection to the database</span>
con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(odbc<span class="op">::</span><span class="kw">odbc</span>(), 
                      <span class="dt">Driver =</span> <span class="st">&quot;SQL Server&quot;</span>, 
                      <span class="dt">Server =</span> <span class="st">&quot;localhost</span><span class="ch">\\</span><span class="st">SQLEXPRESS&quot;</span>, 
                      <span class="dt">Database =</span> <span class="st">&quot;AdventureWorks&quot;</span>, 
                      <span class="dt">Trusted_Connection =</span> <span class="st">&quot;True&quot;</span>)

<span class="co"># Sets knitr to use this connection as the default so we don&#39;t need to specify it for every chunk</span>
knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">connection =</span> <span class="st">&quot;con&quot;</span>)</code></pre></div>
<div id="introduction-to-transact-sql" class="section level2">
<h2><span class="header-section-number">1.1</span> Introduction to Transact-SQL</h2>
<p>SQL or Structured Query Language was first developed in the 1970s by IBM as a way of interacting with databases. Other vendors have specfic versions of SQL for instance Oracle is PL/SQL, Microsoft’s implentation is TSQL or Transact SQL. Both SQL Server (on prem) and Azure SQL Databases (cloud) use the same query language, however Azure is a subset of full TSQL since it some commands relate to local files and data functions within .NET that relate only to SQL Server. However, as new features are added to Azure, some new commands are being added to Azure.</p>
<p>SQL is a declarative language - you express what it is that you want, the results - rather than specifying the steps taken to acheive that - it is not prodecural like other programming languages, it is set theory based. It is possible to write proceedural elements or steps within TSQL, however if this is ocurring a lot, it is perhaps better done in another language, which may also perform or run better.</p>
<p>In databases, we typically talk about entities - one type of thing - which is contained in each table.<br />
* Entities are represented as relations (tables) * And entity attributes as domains (columns)</p>
<p>Most relationships are normalized, with relationships between primary and foreign keys. This helps to reduce duplication, however there are instances where de-normalised data is desired.</p>
<p>Schemas are namespaces for database objects - is shows a logical layout for all or part of a relational database, <em>“As part of a data dictionary, a database schema indicates how the entities that make up the database relate to one another, including tables, views, stored procedures, and more.”</em>(see <a href="https://www.lucidchart.com/pages/database-diagram/database-schema">Lucid Chart on Database Schemas</a>). The process of creating a database schema is called data modelling.</p>
<p>When referring to objects in a database, we could use a fully qualified name, such as:</p>
<ul>
<li>[server_name.][database_name.][schema_name.]object_name</li>
</ul>
<p>This is only really relevant for SQL Server, since Azure will only work with one database at a time. Most of the time we typically just use</p>
<ul>
<li>schema_name.object_name</li>
</ul>
<p>The schema name somwtimes be discarded, but it is considered best practice to include this, since there is sometimes some ambiguity about tables e.g. if we have two tables - Product.Order and Customer.Order - which order table is being referred to, that in the customer or product schema?</p>
<p>SQL has a number of SQL Statement Types:</p>
<ul>
<li>DML or Data Manipulation Language - SELECT, INSERT, UPDATE, DELETE</li>
<li>DDL or Data Definition Language - CREATE, ALTER, DROP</li>
<li>DCL or Data Control Language - GRANT, REVOKE, DENY</li>
</ul>
<p>The course focuses on DML which is typically for working with data.</p>
<p><strong>SELECT</strong> statement has a number of possible sub-components:</p>
<ul>
<li>FROM [table]</li>
<li>WHERE [condition for filtering rows]</li>
<li>GROUP BY [arranges rows by groups]</li>
<li>HAVING [condition for filtering groups]</li>
<li>ORDER BY [sorts the output]</li>
</ul>
<p>Whilst a SQL statement can look like English, it doesn’t neccessarily run from top to bottom in terms of the sequence of elements that are run in a query. For instance, the FROM is the first thing that will be run, then the WHERE filter will be run, then we GROUP BY, then SELECT the columns we are interested in and finally ORDER the results. This can be important when running some queries, which will be explored later in the course. When we run a query, it is not an actual table in a database that is return but a set of rows or record set or subset.</p>
<div id="data-types" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Data Types</h3>
<p>There are a number of different data types in T-SQL as shown below, which are grouped in to a number of different types.</p>
<div class="figure">
<img src="images/TSQL/TSQLDataTypes.png" alt="Transact-SQL Data Types" width="742" />
<p class="caption">
(#fig:Data Types)Transact-SQL Data Types
</p>
</div>
<p>This is more relevant when designing a database, however it is useful to know when querying what data type you have in a broad sense - numeric, data, string and so on - as the types will determine what type of combinations can be combined together in expressions e.g. you can concatenate strings or add numbers together, but you can’t concatenate a string and a number together.</p>
<p>Sometimes it is neccessary to convert data from one type to another, there are two ways this could happen</p>
<ul>
<li>Implicit conversion - compatible data types are automatically converted</li>
<li>Explicit conversion - requires an explicit function e.g. CAST / TRY_CAST, STR, PARSE ? TRY_PARSE, CONVERT / TRY_CONVERT</li>
</ul>
<p>The TRY options will attempt a conversion and if it does not work, a NULL will be returned rather than an error in the non-TRY version.</p>
</div>
<div id="working-with-nulls" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Working with NULLs</h3>
<p>There are recognised standards for treating NULL values - ANSI - which says that anythign involving a NULL should return a NULL. There are functions that help us handle NULL values:</p>
<ul>
<li>ISNULL(column/variable, value) - Returns <em>value</em> (which you can specify) if the column or variable is NULL</li>
<li>NULLIF(column/variable, value) - Returns NULL if the column or variable is a value - we are almost recoding a non-null to a null</li>
<li>COALESCE (column/variable1, column/variable2, …) - Returns the value of the first non-NULL column or variable in the list - for instance if contact details, someone might not have an email, so we might want a telephone number, if they don’t have that, return an address etc</li>
</ul>
<p>NULL is used to indicate an unknown or missing value. NULL is <strong>not</strong> equivalent to zero or an empty string.</p>
<p>ISNULL can be used like an IF function in excel, for instance:</p>
<blockquote>
<p>SELECT name, ISNULL(TRY_CAST(size AS Integer), 0) AS NumericSize<br />
FROM SalesLT.Product;</p>
</blockquote>
<p>In this instance, if there is a value that will be returned, if not, the NULL value will be returned as a 0.</p>
<p>We can also use a CASE statement to return a value whilst integrating NULL in to our query, e.g.</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> name,  
    <span class="kw">CASE</span> <span class="kw">size</span>  
      <span class="kw">WHEN</span> <span class="st">&#39;S&#39;</span> <span class="kw">THEN</span> <span class="st">&#39;SMALL&#39;</span>  
      <span class="kw">WHEN</span> <span class="st">&#39;M&#39;</span> <span class="kw">THEN</span> <span class="st">&#39;MEDIUM&#39;</span>  
      <span class="kw">WHEN</span> <span class="st">&#39;L&#39;</span> <span class="kw">THEN</span> <span class="st">&#39;LARGE&#39;</span>  
      <span class="kw">WHEN</span> <span class="st">&#39;XL&#39;</span> <span class="kw">THEN</span> <span class="st">&#39;EXTRA LARGE&#39;</span>  
      <span class="kw">ELSE</span> ISNULL(<span class="kw">Size</span>, <span class="st">&#39;N/A&#39;</span>)  
    <span class="kw">END</span> <span class="kw">AS</span> PRODUCT  
  <span class="kw">FROM</span> SalesLT.Product; </code></pre></div>
</div>
<div id="lab-exercises" class="section level3">
<h3><span class="header-section-number">1.1.3</span> Lab Exercises</h3>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> TOP(<span class="dv">10</span>) BusinessEntityID, Name
<span class="kw">FROM</span> Sales.Store;</code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-2">Table 1.1: </span>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th align="right">BusinessEntityID</th>
<th align="left">Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">292</td>
<td align="left">Next-Door Bike Store</td>
</tr>
<tr class="even">
<td align="right">294</td>
<td align="left">Professional Sales and Service</td>
</tr>
<tr class="odd">
<td align="right">296</td>
<td align="left">Riders Company</td>
</tr>
<tr class="even">
<td align="right">298</td>
<td align="left">The Bike Mechanics</td>
</tr>
<tr class="odd">
<td align="right">300</td>
<td align="left">Nationwide Supply</td>
</tr>
<tr class="even">
<td align="right">302</td>
<td align="left">Area Bike Accessories</td>
</tr>
<tr class="odd">
<td align="right">304</td>
<td align="left">Bicycle Accessories and Kits</td>
</tr>
<tr class="even">
<td align="right">306</td>
<td align="left">Clamps &amp; Brackets Co.</td>
</tr>
<tr class="odd">
<td align="right">308</td>
<td align="left">Valley Bicycle Specialists</td>
</tr>
<tr class="even">
<td align="right">310</td>
<td align="left">New Bikes Company</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["BI-Notes.pdf", "BI-Notes.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
